# Refactor Manifest (Dual-Runtime Transitional)

Generated by:
- scripts/generate_refactor_manifest.sh

## Inventory Summary
- Rust FFI exports (#[no_mangle]): 802
- Rust extern \"C\" declarations/defs: 1085
- Rust unsafe blocks in mtproxy-ffi: 4218

Detailed inventories:
- docs/generated/no_mangle_inventory.txt
- docs/generated/extern_c_inventory.txt
- docs/generated/unsafe_inventory.txt
- docs/ffi_symbol_index.csv

## Rules Enforced
- No new C ABI exports in transitional period.
- New runtime behavior lands in mtproxy-core or mtproxy-bin only.
- mtproxy-ffi is adapter-only while dual-runtime support remains.

## Migration Wave Order
1. Network core (net/*, tcp-rpc client/server/common) [R3]
2. Bootstrap/util (common/*, engine/*) [R2]
3. Crypto residuals and protocol helpers [R3]

## Wave A Progress (Current)
- `tcp_rpc_server` policy/validation moved to `mtproxy-core::runtime::net::tcp_rpc_server`; FFI server runtime reduced to adapter behavior.
- `tcp_rpc_client` nonce/handshake validation and client permission/readiness/fake-crypto policy moved to `mtproxy-core::runtime::net::tcp_rpc_client`.
- `net_events` epoll flag conversion + loop continuation + idle-decay policy now routed through `mtproxy-core::runtime::net::events`.
- `net_connections` connection-job dispatch and target-job dispatch/post-tick/finalize mapping now routed through `mtproxy-core::runtime::net::connections`.

### Transitional Rules Re-affirmed
- No new `#[no_mangle]` exports.
- No new ABI additions in `rust/mtproxy-ffi/include/mtproxy_ffi.h`.
- New runtime behavior continues to land in `mtproxy-core`/`mtproxy-bin`; `mtproxy-ffi` remains adapter-first.

## Risk Labels
- R0: pure wrapper glue
- R1: stateful local logic
- R2: cross-thread/global mutable state
- R3: protocol/security-critical paths
